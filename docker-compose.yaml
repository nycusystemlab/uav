services:
  drone-cam:
    # 修改 1: 必須使用支援 Jetson Nano (L4T R32.7.1 / JetPack 4.6) 的 Humble 映像檔
    # 這是 dustynv 專為 Nano 編譯的版本，解決了 Kernel 4.9 與 Humble 的相容性問題
    image: dustynv/ros:humble-desktop-l4t-r32.7.1
    
    container_name: drone_camera
    
    # 修改 2: 雖然你說沒 GPU，但在 Nano 上掛載 runtime: nvidia 
    # 有助於解決 USB 裝置存取權限與底層驅動對應問題 (即使只用 CPU)
    runtime: nvidia
    
    network_mode: host
    ipc: host
    restart: always

    devices:
      - /dev/video0:/dev/video0
    
    # 在某些 Nano 設定中，開啟 privileged 有助於解決 V4L2 存取問題
    privileged: true

    environment:
      - ROS_DOMAIN_ID=0
      - RMW_IMPLEMENTATION=rmw_cyclonedds_cpp
      # 修正顯示相關錯誤 (Headless 模式不需要 DISPLAY，但桌面版 image 可能會跳 warning)
      - DISPLAY=:0 

    # 啟動指令
    command: >
      ros2 run image_tools cam2image
      --ros-args
      -p device_id:=0
      -p width:=640
      -p height:=480
      -p frequency:=15.0
      -p burger_mode:=false
      -r /image:=/drone/image_raw